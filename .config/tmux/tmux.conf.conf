unbind -T root -a
###########
# options #
###########

# global options
set -g prefix C-a
set -g default-terminal "screen-256color"
set -g escape-time 40
set -g allow-rename off
## Window options
set -g base-index 1
## Pane options
setw -g pane-base-index 1
setw -g visual-bell on
setw -g visual-activity on

# Reset input state
select-pane -e
set-hook -gu client-attached "select-pane -d"
set-hook -gu client-focus-in "select-pane -d"
set-hook -gu window-pane-changed "select-pane -d"
set-hook -gu session-window-changed "select-pane -d"

# True color settings
set -g default-terminal "$TERM"
set -ag terminal-overrides ",$TERM:Tc"

############
# Keybinds #
############

# Unbinding defaults
unbind C-b
unbind x
unbind c
unbind ,

# Prefix binds
## General binds
bind C-a send-prefix
bind g send-keys C-g
bind : command-prompt

## Pane
bind -T root C-p source "$HOME/.config/tmux/pane.conf"

## Move
bind -T root C-b source "$HOME/.config/tmux/move.conf"

## Resize
bind -T root C-n source "$HOME/.config/tmux/resize.conf"

## Window
bind -T root C-w source "$HOME/.config/tmux/window.conf"

## Session
bind -T root C-s source "$HOME/.config/tmux/session.conf"

## NOTE: root binds (very important!)

### Layout switching
bind -T root M-[ previous-layout
bind -T root M-] next-layout

### Quick pane/window creation
bind -T root M-n split-window -h
bind -T root M-w new-window
bind -T root M-f run-shell "$XDG_CONFIG_HOME/tmux/scripts/popup.sh"

# Smart pane switching with awareness of Vim splits.
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-h if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n C-j if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n C-k if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n C-l if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

bind-key -n M-h if-shell "$is_vim" 'send-keys M-h' 'resize-pane -L 3'
bind-key -n M-j if-shell "$is_vim" 'send-keys M-j' 'resize-pane -D 3'
bind-key -n M-k if-shell "$is_vim" 'send-keys M-k' 'resize-pane -U 3'
bind-key -n M-l if-shell "$is_vim" 'send-keys M-l' 'resize-pane -R 3'
## bind-key -n C-f if-shell "$is_vim" 'send-keys C-f' 'run-shell ". ~/tmux/find_file.sh"'
bind-key q if-shell "$is_vim" 'send-keys C-q' 'kill-pane'
bind-key k if-shell "$is_vim" 'send-keys :' 'send-keys "clear\n"'


# Smart pane switching with awareness of vim and fzf
forward_programs="view|n?vim?|fzf"

should_forward="ps -o state= -o comm= -t '#{pane_tty}' \
   | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?($forward_programs)(diff)?$'"

 bind -n C-h if-shell "$should_forward" "send-keys C-h" "select-pane -L"
 bind -n C-j if-shell "$should_forward" "send-keys C-j" "select-pane -D"
 bind -n C-k if-shell "$should_forward" "send-keys C-k" "select-pane -U"
 bind -n C-l if-shell "$should_forward" "send-keys C-l" "select-pane -R"

# window switch
bind-key n select-window -t +1
bind-key p select-window -t -1

# session switch
unbind ]
unbind [
bind ] switch-client -n
bind [ switch-client -p

# split window
unbind %
bind | split-window -h -c "#{pane_current_path}"
unbind '"'
bind - split-window -v -c "#{pane_current_path}"

# reload
unbind r
bind r source-file ~/.tmux.conf \; display-message "Config reloaded..."

# new window
bind t new-window -c "#{pane_current_path}"

# zoom
bind m resize-pane -Z

### "Locked" mode
# Cannot use any binds while in this mode
bind -T root C-g source "$XDG_CONFIG_HOME/tmux/locked.conf"

############
# Themeing #
############

set -g status-position top
set -g status-justify left
set -g status-style default
set -g status-left ''
set-option -g status-right '#[fg=#434242,bg=default]#[fg=#a3a3a3,bg=#434242] #S #[fg=#434242,bg=default]'
set -g status-right-length 50
set -g status-left-length 10

set -g window-status-current-format "#[fg=#F4EEE0,bg=default]#W#(printf '%%s\n' '#F' | tr 'Z' '󰊓' | tr '*' '')"

set -g window-status-format "#[fg=#a3a3a3,bg=default]#W#(printf '%%s\n' '#F' | tr '-' '' | tr 'Z' '󰊓')"
setw -g window-status-bell-style 'fg=#3c3836 bg=#fb4934 bold'

# Border styles


# tpm plugin
set -g @plugin 'tmux-plugins/tpm'
############################################## Plugins ###################################################################

set -g @plugin 'omerxx/tmux-sessionx'
set -g @sessionx-bind 'o'
set -g @sessionx-zoxide-mode 'on'
set -g @sessionx-filter-current 'false'
set -g @sessionx-tree-mode 'on'
set -g @sessionx-layout 'reverse'
set -g @sessionx-preview-location 'right'
set -g @sessionx-preview-ratio '50%'
set -g @sessionx-window-height '50%'
set -g @sessionx-window-width '75%'
set -g @sessionx-prompt ">> "

set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @resurrect-capture-pane-contents 'on'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'off'

set -g @plugin 'trevarj/tmux-open-nvim'

set -g @plugin 'thesast/tmux-keylocker'
set -g @keylocker-toggle-bind 'F3'
########################################################################################################################
run '~/.tmux/plugins/tpm/tpm'
